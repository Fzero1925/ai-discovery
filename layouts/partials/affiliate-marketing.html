<!-- è”ç›Ÿè¥é”€è‡ªåŠ¨åŒ–ç³»ç»Ÿ - AIå·¥å…·ä¸“ç”¨ -->

<!-- è”ç›Ÿé“¾æ¥ç®¡ç†æ•°æ® -->
{{ $affiliateData := dict
  "jasper" (dict "url" "https://jasper.ai/?via=aidiscovery" "commission" "30%" "cookie" "45å¤©")
  "copy_ai" (dict "url" "https://copy.ai?via=aidiscovery" "commission" "25%" "cookie" "30å¤©")
  "notion" (dict "url" "https://notion.so?r=aidiscovery" "commission" "20%" "cookie" "180å¤©")
  "grammarly" (dict "url" "https://grammarly.com/a/aidiscovery" "commission" "20%" "cookie" "90å¤©")
  "canva" (dict "url" "https://canva.com/p/aidiscovery" "commission" "15%" "cookie" "30å¤©")
  "midjourney" (dict "url" "https://midjourney.com/?ref=aidiscovery" "commission" "N/A" "cookie" "N/A")
  "leonardo_ai" (dict "url" "https://leonardo.ai?via=aidiscovery" "commission" "25%" "cookie" "30å¤©")
  "cursor_ai" (dict "url" "https://cursor.so?ref=aidiscovery" "commission" "30%" "cookie" "60å¤©")
  "zapier" (dict "url" "https://zapier.com/l/aidiscovery" "commission" "25%" "cookie" "90å¤©")
}}

<!-- ä¸»è¦CTAæŒ‰é’® - é’ˆå¯¹å½“å‰è¯„æµ‹å·¥å…· -->
{{ if and (.Params.tool_name) (.IsPage) (eq .Section "reviews") }}
  {{ $toolKey := lower (.Params.tool_name | replaceRE "[^a-zA-Z0-9]" "_") }}
  {{ $affiliateInfo := index $affiliateData $toolKey }}
  
  <div class="affiliate-cta-container">
    <div class="affiliate-main-cta">
      {{ if $affiliateInfo }}
        <a href="{{ $affiliateInfo.url }}" 
           class="btn-affiliate-primary"
           target="_blank" 
           rel="nofollow sponsored"
           data-tool="{{ .Params.tool_name }}"
           onclick="trackAffiliate('{{ .Params.tool_name }}', 'main_cta')">
          ğŸš€ å¼€å§‹å…è´¹è¯•ç”¨ {{ .Params.tool_name }}
          <span class="affiliate-badge">é™æ—¶ä¼˜æƒ </span>
        </a>
        
        <div class="affiliate-info">
          <small>
            âœ… {{ $affiliateInfo.cookie }}å…è´¹è¯•ç”¨æœŸ | 
            ğŸ’° ä½£é‡‘æ”¯æŒæœ¬ç«™è¿è¥ ({{ $affiliateInfo.commission }}) |
            ğŸ”’ ä»·æ ¼ä¸å˜ï¼Œæ”¯æŒå†…å®¹åˆ›ä½œ
          </small>
        </div>
      {{ else }}
        <!-- é€šç”¨CTA -->
        <a href="#" 
           class="btn-affiliate-primary"
           onclick="trackAffiliate('{{ .Params.tool_name }}', 'generic_cta')">
          ğŸ” æŸ¥çœ‹ {{ .Params.tool_name }} å®˜æ–¹ç½‘ç«™
        </a>
      {{ end }}
    </div>
  </div>
{{ end }}

<!-- ä»·æ ¼å¯¹æ¯”è¡¨æ ¼ - å¸¦è”ç›Ÿé“¾æ¥ -->
{{ if .Params.pricing_comparison }}
<div class="affiliate-pricing-table">
  <h3>ğŸ’° ä»·æ ¼å¯¹æ¯” - æœ€ä¼˜æƒ æ¸ é“</h3>
  <div class="pricing-grid">
    {{ range .Params.pricing_comparison }}
    <div class="pricing-card">
      <div class="pricing-header">
        <h4>{{ .plan_name }}</h4>
        <div class="price">{{ .price }}</div>
      </div>
      <div class="pricing-features">
        {{ range .features }}
        <div class="feature">âœ… {{ . }}</div>
        {{ end }}
      </div>
      <div class="pricing-cta">
        {{ $toolKey := lower ($.Params.tool_name | replaceRE "[^a-zA-Z0-9]" "_") }}
        {{ $affiliateInfo := index $affiliateData $toolKey }}
        
        {{ if $affiliateInfo }}
        <a href="{{ $affiliateInfo.url }}" 
           class="btn-affiliate-secondary"
           target="_blank" 
           rel="nofollow sponsored"
           onclick="trackAffiliate('{{ $.Params.tool_name }}', 'pricing_{{ .plan_name }}')">
          ç«‹å³è®¢é˜…
        </a>
        {{ else }}
        <a href="#" class="btn-affiliate-secondary">äº†è§£æ›´å¤š</a>
        {{ end }}
      </div>
    </div>
    {{ end }}
  </div>
</div>
{{ end }}

<!-- æ›¿ä»£å·¥å…·æ¨è - äº¤å‰é”€å”® -->
<div class="affiliate-alternatives">
  <h3>ğŸ”„ ç›¸å…³AIå·¥å…·æ¨è</h3>
  <div class="alternatives-grid">
    
    <!-- å†…å®¹åˆ›ä½œå·¥å…·æ¨è -->
    {{ if eq .Params.categories "content-creation" }}
    <div class="alternative-item">
      <h4>âœï¸ Jasper AI</h4>
      <p>ä¸“ä¸šçº§AIå†™ä½œåŠ©æ‰‹ï¼Œé€‚åˆè¥é”€å›¢é˜Ÿ</p>
      <a href="{{ (index $affiliateData "jasper").url }}" 
         target="_blank" 
         rel="nofollow sponsored"
         onclick="trackAffiliate('Jasper', 'alternative_recommendation')">
        å…è´¹è¯•ç”¨ â†’
      </a>
    </div>
    
    <div class="alternative-item">
      <h4>ğŸ“ Copy.ai</h4>
      <p>å¿«é€Ÿç”Ÿæˆè¥é”€æ–‡æ¡ˆå’Œç¤¾äº¤åª’ä½“å†…å®¹</p>
      <a href="{{ (index $affiliateData "copy_ai").url }}" 
         target="_blank" 
         rel="nofollow sponsored"
         onclick="trackAffiliate('Copy.ai', 'alternative_recommendation')">
        å…è´¹è¯•ç”¨ â†’
      </a>
    </div>
    {{ end }}
    
    <!-- å›¾åƒç”Ÿæˆå·¥å…·æ¨è -->
    {{ if eq .Params.categories "image-generation" }}
    <div class="alternative-item">
      <h4>ğŸ¨ Leonardo AI</h4>
      <p>é«˜è´¨é‡AIå›¾åƒç”Ÿæˆï¼Œé€‚åˆè®¾è®¡å¸ˆ</p>
      <a href="{{ (index $affiliateData "leonardo_ai").url }}" 
         target="_blank" 
         rel="nofollow sponsored"
         onclick="trackAffiliate('Leonardo AI', 'alternative_recommendation')">
        å…è´¹è¯•ç”¨ â†’
      </a>
    </div>
    {{ end }}
    
    <!-- ä»£ç è¾…åŠ©å·¥å…·æ¨è -->
    {{ if eq .Params.categories "code-assistance" }}
    <div class="alternative-item">
      <h4>ğŸ’» Cursor AI</h4>
      <p>AIé©±åŠ¨çš„ä»£ç ç¼–è¾‘å™¨ï¼Œæå‡å¼€å‘æ•ˆç‡</p>
      <a href="{{ (index $affiliateData "cursor_ai").url }}" 
         target="_blank" 
         rel="nofollow sponsored"
         onclick="trackAffiliate('Cursor AI', 'alternative_recommendation')">
        å…è´¹è¯•ç”¨ â†’
      </a>
    </div>
    {{ end }}
    
    <!-- ç”Ÿäº§åŠ›å·¥å…·æ¨è -->
    {{ if eq .Params.categories "productivity" }}
    <div class="alternative-item">
      <h4>ğŸ“‹ Notion AI</h4>
      <p>æ™ºèƒ½ç¬”è®°å’Œé¡¹ç›®ç®¡ç†ä¸€ä½“åŒ–å¹³å°</p>
      <a href="{{ (index $affiliateData "notion").url }}" 
         target="_blank" 
         rel="nofollow sponsored"
         onclick="trackAffiliate('Notion', 'alternative_recommendation')">
        å…è´¹è¯•ç”¨ â†’
      </a>
    </div>
    {{ end }}
    
  </div>
</div>

<!-- ç‰¹æ®Šä¼˜æƒ æé†’ -->
<div class="affiliate-special-offer">
  <div class="offer-content">
    <div class="offer-icon">ğŸ‰</div>
    <div class="offer-text">
      <h4>é™æ—¶ä¼˜æƒ æé†’</h4>
      <p>é€šè¿‡æˆ‘ä»¬çš„é“¾æ¥æ³¨å†Œï¼Œäº«å—ä¸“å±ä¼˜æƒ ä»·æ ¼ï¼ŒåŒæ—¶æ”¯æŒæˆ‘ä»¬ç»§ç»­æä¾›ä¼˜è´¨çš„AIå·¥å…·è¯„æµ‹å†…å®¹ã€‚</p>
    </div>
  </div>
</div>

<!-- è”ç›Ÿè¥é”€æŠ«éœ²å£°æ˜ -->
<div class="affiliate-disclosure">
  <h4>ğŸ’¡ è”ç›Ÿè¥é”€å£°æ˜</h4>
  <p>
    æœ¬æ–‡åŒ…å«è”ç›Ÿè¥é”€é“¾æ¥ã€‚å½“æ‚¨é€šè¿‡æˆ‘ä»¬çš„é“¾æ¥è´­ä¹°äº§å“æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè·å¾—å°‘é‡ä½£é‡‘ï¼Œä½†è¿™ä¸ä¼šå½±å“æ‚¨çš„è´­ä¹°ä»·æ ¼ã€‚
    è¿™äº›ä½£é‡‘å¸®åŠ©æˆ‘ä»¬ç»´æŠ¤ç½‘ç«™è¿è¥ï¼Œç»§ç»­ä¸ºæ‚¨æä¾›å…è´¹ã€å®¢è§‚çš„AIå·¥å…·è¯„æµ‹å†…å®¹ã€‚
    æˆ‘ä»¬åªæ¨èç»è¿‡å®é™…æµ‹è¯•å’ŒéªŒè¯çš„ä¼˜è´¨å·¥å…·ã€‚
  </p>
</div>

<!-- è”ç›Ÿè¥é”€CSSæ ·å¼ -->
<style>
/* ä¸»è¦CTAæ ·å¼ */
.affiliate-cta-container {
  margin: 30px 0;
  text-align: center;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 12px;
  padding: 25px;
  color: white;
}

.btn-affiliate-primary {
  display: inline-block;
  background: #28a745;
  color: white;
  padding: 15px 30px;
  border-radius: 8px;
  text-decoration: none;
  font-weight: 600;
  font-size: 18px;
  transition: all 0.3s ease;
  position: relative;
  margin-bottom: 10px;
}

.btn-affiliate-primary:hover {
  background: #218838;
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
}

.affiliate-badge {
  position: absolute;
  top: -5px;
  right: -5px;
  background: #ff6b6b;
  color: white;
  font-size: 10px;
  padding: 2px 6px;
  border-radius: 10px;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

.affiliate-info {
  margin-top: 10px;
  font-size: 13px;
  opacity: 0.9;
}

/* ä»·æ ¼å¯¹æ¯”è¡¨æ ¼ */
.affiliate-pricing-table {
  margin: 40px 0;
  background: #f8f9fa;
  border-radius: 12px;
  padding: 25px;
}

.pricing-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

.pricing-card {
  background: white;
  border-radius: 8px;
  padding: 20px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  transition: transform 0.3s ease;
}

.pricing-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.pricing-header h4 {
  margin: 0 0 10px 0;
  color: #333;
}

.price {
  font-size: 24px;
  font-weight: 700;
  color: #28a745;
  margin-bottom: 15px;
}

.pricing-features {
  margin-bottom: 20px;
}

.feature {
  margin: 8px 0;
  font-size: 14px;
}

.btn-affiliate-secondary {
  display: block;
  background: #007bff;
  color: white;
  padding: 12px 20px;
  border-radius: 6px;
  text-decoration: none;
  text-align: center;
  transition: all 0.3s ease;
}

.btn-affiliate-secondary:hover {
  background: #0056b3;
  transform: translateY(-1px);
}

/* æ›¿ä»£å·¥å…·æ¨è */
.affiliate-alternatives {
  margin: 40px 0;
  background: #fff8e1;
  border-radius: 12px;
  padding: 25px;
}

.alternatives-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

.alternative-item {
  background: white;
  border-radius: 8px;
  padding: 20px;
  border-left: 4px solid #ffc107;
}

.alternative-item h4 {
  margin: 0 0 10px 0;
  color: #333;
}

.alternative-item p {
  color: #666;
  margin-bottom: 15px;
  font-size: 14px;
}

.alternative-item a {
  color: #007bff;
  text-decoration: none;
  font-weight: 600;
  font-size: 14px;
}

.alternative-item a:hover {
  color: #0056b3;
}

/* ç‰¹æ®Šä¼˜æƒ æé†’ */
.affiliate-special-offer {
  margin: 30px 0;
  background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
  border-radius: 12px;
  padding: 20px;
}

.offer-content {
  display: flex;
  align-items: center;
  gap: 15px;
}

.offer-icon {
  font-size: 32px;
  flex-shrink: 0;
}

.offer-text h4 {
  margin: 0 0 8px 0;
  color: #333;
}

.offer-text p {
  margin: 0;
  color: #666;
  font-size: 14px;
}

/* è”ç›Ÿè¥é”€æŠ«éœ² */
.affiliate-disclosure {
  margin: 40px 0;
  background: #e9ecef;
  border-radius: 8px;
  padding: 20px;
  border-left: 4px solid #6c757d;
}

.affiliate-disclosure h4 {
  margin: 0 0 10px 0;
  color: #495057;
  font-size: 16px;
}

.affiliate-disclosure p {
  margin: 0;
  color: #6c757d;
  font-size: 13px;
  line-height: 1.5;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .affiliate-cta-container {
    padding: 20px 15px;
  }
  
  .btn-affiliate-primary {
    font-size: 16px;
    padding: 12px 25px;
  }
  
  .pricing-grid {
    grid-template-columns: 1fr;
  }
  
  .alternatives-grid {
    grid-template-columns: 1fr;
  }
  
  .offer-content {
    flex-direction: column;
    text-align: center;
  }
}
</style>

<!-- è”ç›Ÿè¥é”€è·Ÿè¸ªè„šæœ¬ -->
<script>
function trackAffiliate(toolName, clickType) {
  // Google Analyticsäº‹ä»¶è·Ÿè¸ª
  if (typeof gtag !== 'undefined') {
    gtag('event', 'affiliate_click', {
      event_category: 'Affiliate Marketing',
      event_label: toolName + ' - ' + clickType,
      value: 1
    });
  }
  
  // è‡ªå®šä¹‰è·Ÿè¸ª (å¯é€‰)
  try {
    fetch('/api/track-affiliate', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({
        tool: toolName,
        type: clickType,
        page: window.location.pathname,
        timestamp: new Date().toISOString()
      })
    }).catch(e => console.log('Tracking failed:', e));
  } catch(e) {
    console.log('Affiliate tracking error:', e);
  }
}

// é“¾æ¥ç‚¹å‡»å¢å¼º
document.addEventListener('DOMContentLoaded', function() {
  // ä¸ºæ‰€æœ‰è”ç›Ÿé“¾æ¥æ·»åŠ é¢å¤–å±æ€§
  const affiliateLinks = document.querySelectorAll('a[rel*="sponsored"]');
  affiliateLinks.forEach(link => {
    // æ·»åŠ UTMå‚æ•°ç”¨äºè·Ÿè¸ª
    const url = new URL(link.href);
    url.searchParams.set('utm_source', 'aidiscovery');
    url.searchParams.set('utm_medium', 'affiliate');
    url.searchParams.set('utm_campaign', 'tool_review');
    link.href = url.toString();
    
    // æ·»åŠ å¤–é“¾å›¾æ ‡
    if (!link.querySelector('.external-icon')) {
      const icon = document.createElement('span');
      icon.innerHTML = ' â†—ï¸';
      icon.className = 'external-icon';
      link.appendChild(icon);
    }
  });
});
</script>