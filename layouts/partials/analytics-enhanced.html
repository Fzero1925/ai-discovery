<!-- 澧炲己鐨凣oogle Analytics 4璺熻釜 -->
{{ if site.Params.google_analytics_id }}
<script async src="https://www.googletagmanager.com/gtag/js?id={{ site.Params.google_analytics_id }}"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    
    gtag('config', '{{ site.Params.google_analytics_id }}', {
        // 澧炲己鐢靛瓙鍟嗗姟璺熻釜
        enhanced_ecommerce: true,
        // 鑷姩璺熻釜澶栭摼鐐瑰嚮
        link_attribution: true,
        // 璺熻釜鏂囦欢涓嬭浇
        file_downloads: true,
        // 璺熻釜婊氬姩娣卞害
        page_title: document.title,
        page_location: window.location.href
    });

    // 璺熻釜AI宸ュ叿璇勬祴椤甸潰鐨勭壒瀹氫簨浠?
    {{ if eq .Type "guides" }}
    gtag('event', 'page_view', {
        'page_category': 'AI Tool Guide',
        'ai_tool_name': '{{ .Params.title }}',
        'tool_category': '{{ index .Params.categories 0 }}',
        'commercial_intent': '{{ .Params.commercial_intent }}'
    });
    {{ end }}

    // 璺熻釜澶栭儴閾炬帴鐐瑰嚮锛堣仈鐩熻惀閿€锛?
    document.addEventListener('click', function(event) {
        if (event.target.tagName === 'A' && event.target.hostname !== window.location.hostname) {
            gtag('event', 'click', {
                'event_category': 'External Link',
                'event_label': event.target.href,
                'transport_type': 'beacon'
            });
        }
    });

    // 璺熻釜鎼滅储鍔熻兘浣跨敤
    document.addEventListener('DOMContentLoaded', function() {
        const searchForm = document.querySelector('.search-form');
        if (searchForm) {
            searchForm.addEventListener('submit', function(event) {
                const searchTerm = event.target.querySelector('input[type="search"]').value;
                gtag('event', 'search', {
                    'search_term': searchTerm
                });
            });
        }
    });

    // 璺熻釜婊氬姩娣卞害
    let scrollDepth = 0;
    let scrollTimer = null;
    
    window.addEventListener('scroll', function() {
        clearTimeout(scrollTimer);
        scrollTimer = setTimeout(function() {
            const currentDepth = Math.round((window.scrollY + window.innerHeight) / document.body.scrollHeight * 100);
            if (currentDepth > scrollDepth && currentDepth >= 25) {
                scrollDepth = Math.floor(currentDepth / 25) * 25;
                gtag('event', 'scroll', {
                    'event_category': 'User Engagement',
                    'event_label': scrollDepth + '%',
                    'value': scrollDepth
                });
            }
        }, 500);
    });
</script>
{{ end }}
